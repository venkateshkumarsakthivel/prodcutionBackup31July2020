/**
 * Test Class For OT API Proxy
 */
@isTest 
private  class P2POTAppClientTest {
    
    public class OTClientTestVisitor implements AWSC_ResponseParserVisitor{
        public Integer responseStatus {get; set;}
        public String responseText {get; set;}
        public void visit(AWSC_ResponseParser responseParser){
			P2POTAppClient.P2POTResponseParser resP = (P2POTAppClient.P2POTResponseParser)responseParser;
            responseStatus = resP.responseStatus;
            responseText = resP.responseText;
        }
    }
	
    private static testmethod void testCreateNode(){
        P2POTAppClient.P2POTRequestParam params = new P2POTAppClient.P2POTRequestParam();
        params.nodeName = '1234567899';
        params.fileName = 'APITest1.txt';
        params.fileData = 'this is dummy data';
        params.fileBlob = EncodingUtil.base64Decode(params.fileData);
        P2POTAppClient client = new P2POTAppClient();
        OTClientTestVisitor visitor = new OTClientTestVisitor();
        client.callOTApp(P2POTAppClient.OT_REQUEST_TYPE.CREATENODE, visitor, params);
        
        System.assert(visitor.responseStatus == P2POTConstants.HTTP_OK, 'Incorrect Response Status - Expected Accepted, received: ' + visitor.responseStatus);
    } 
    
    private static testmethod void testBrowseNode(){
        P2POTAppClient.P2POTRequestParam params = new P2POTAppClient.P2POTRequestParam();
        params.nodeName = '5000l000000vGoqAAE';
        P2POTAppClient client = new P2POTAppClient();
        OTClientTestVisitor visitor = new OTClientTestVisitor();
        client.callOTApp(P2POTAppClient.OT_REQUEST_TYPE.BROWSENODE, visitor, params);
        System.assert(visitor.responseStatus == P2POTConstants.HTTP_OK, 'Incorrect Response Status - Expected OK, received: ' + visitor.responseStatus);
        System.assert(visitor.responseText == '{"collection": {"paging": {"limit": 25, "page": 1, "page_total": 1, "range_max": 6, "range_min": 1, "total_count": 6 }, "sorting": {"sort": [{"key": "sort", "value": "asc_name"} ] } }, "links": {"data": {"self": {"body": "", "content_type": "", "href": "/api/v2/nodes/208503/nodes/", "method": "GET", "name": ""} } }, "results": [{"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2015-11-04T12:34:21", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208504, "mime_type": null, "modify_date": "2017-07-19T05:32:00", "modify_user_id": 1000, "name": "01 - Problem Description", "name_multilingual": {"en_AU": "01 - Problem Description", "en_US": "01 - Problem Description"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 0, "type_name": "Folder", "versions_control_advanced": false, "volume_id": 208503 } } }, {"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2015-11-04T12:34:35", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208506, "mime_type": null, "modify_date": "2017-07-19T05:32:01", "modify_user_id": 1000, "name": "02 - Analysis Documents", "name_multilingual": {"en_AU": "02 - Analysis Documents", "en_US": "02 - Analysis Documents"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 0, "type_name": "Folder", "versions_control_advanced": false, "volume_id": 208503 } } }, {"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2015-11-04T12:34:49", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208505, "mime_type": null, "modify_date": "2017-07-19T05:32:00", "modify_user_id": 1000, "name": "03 - Results", "name_multilingual": {"en_AU": "03 - Results", "en_US": "03 - Results"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 0, "type_name": "Folder", "versions_control_advanced": false, "volume_id": 208503 } } }, {"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2015-11-04T12:35:13", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208507, "mime_type": null, "modify_date": "2017-07-19T05:32:01", "modify_user_id": 1000, "name": "04 - Correspondence", "name_multilingual": {"en_AU": "04 - Correspondence", "en_US": "04 - Correspondence"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 0, "type_name": "Folder", "versions_control_advanced": false, "volume_id": 208503 } } }, {"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2015-11-04T12:40:32", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208508, "mime_type": null, "modify_date": "2017-07-19T05:32:01", "modify_user_id": 1000, "name": "05 - Solutions", "name_multilingual": {"en_AU": "05 - Solutions", "en_US": "05 - Solutions"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 854, "type_name": "Related Business Workspaces", "versions_control_advanced": false, "volume_id": 208503 } } }, {"data": {"categories": [{"104184_2_1_10": "", "104184_2_1_11": "Share-a-Doc", "104184_2_1_12": "Service Provider Application", "104184_2_1_13": "Web", "104184_2_1_14": "", "104184_2_1_15": "2017-07-19T05:31:56", "104184_2_1_16": null, "104184_2_1_17": null, "104184_2_1_18": null, "104184_2_1_19": null, "104184_2_1_20": null, "104184_2_1_21": "", "104184_2_1_22": "", "104184_2_1_23": "", "104184_2_1_28": "5000l000000vGoqAAE", "104184_2_1_5": "Avinash Thatte", "104184_2_1_6": "00001042", "104184_2_1_7": "New", "104184_2_1_8": "Medium", "104184_2_1_9": "Avinash Thatte", "104184_30_1_31": null, "104184_30_1_32": null, "104184_30_1_33": null, "104184_30_1_34": null, "104184_30_1_35": null, "104184_3_1_24": "Avinash Thatte", "104184_3_1_25": "2017-07-19T05:31:56", "104184_4_1_26": "Avinash Thatte", "104184_4_1_27": "2017-07-19T05:31:56"} ], "columns": [{"data_type": 2, "key": "type", "name": "Type", "sort_key": "x4199"}, {"data_type": -1, "key": "name", "name": "Name", "sort_key": "x4196"}, {"data_type": -1, "key": "size_formatted", "name": "Size", "sort_key": "x4197"}, {"data_type": 401, "key": "modify_date", "name": "Modified", "sort_key": "x4195"} ], "properties": {"container": true, "container_size": 0, "create_date": "2016-09-27T11:55:35", "create_user_id": 1000, "description": "", "description_multilingual": {"en_AU": "", "en_US": ""}, "external_create_date": null, "external_identity": "", "external_identity_type": "", "external_modify_date": null, "external_source": "", "favorite": false, "id": 208509, "mime_type": null, "modify_date": "2017-07-19T05:32:01", "modify_user_id": 1000, "name": "06 - Asset", "name_multilingual": {"en_AU": "06 - Asset", "en_US": "06 - Asset"}, "owner_group_id": 1001, "owner_user_id": 1000, "parent_id": -208503, "reserved": false, "reserved_date": null, "reserved_user_id": 0, "size": 0, "size_formatted": "0 Items", "type": 854, "type_name": "Related Business Workspaces", "versions_control_advanced": false, "volume_id": 208503 } } } ] }', 'Incorrect Response Data');
    } 
    private static testmethod void testNodeContent(){
        P2POTAppClient.P2POTRequestParam params = new P2POTAppClient.P2POTRequestParam();
        params.nodeName = 'APITest1.txt';
        P2POTAppClient client = new P2POTAppClient();
        OTClientTestVisitor visitor = new OTClientTestVisitor();
        client.callOTApp(P2POTAppClient.OT_REQUEST_TYPE.NODECONTENT, visitor, params);
        System.assert(visitor.responseStatus == P2POTConstants.HTTP_OK, 'Incorrect Response Status - Expected OK, received: ' + visitor.responseStatus);
        System.assert(visitor.responseText == 'This is a test File\nThis is Line #2', 'Incorrect Response Data');
    }
}